# PyCardGolf

<!-- Pytest Coverage Comment:Begin -->
<a href="https://github.com/hwilco/PyCardGolf/blob/main/README.md"><img alt="Coverage" src="https://img.shields.io/badge/Coverage-68%25-yellow.svg" /></a><details><summary>Coverage Report </summary><table><tr><th>File</th><th>Stmts</th><th>Miss</th><th>Cover</th><th>Missing</th></tr><tbody><tr><td colspan="5"><b>src/pycardgolf</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/__init__.py">__init__.py</a></td><td>3</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/exceptions.py">exceptions.py</a></td><td>2</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py">main.py</a></td><td>21</td><td>21</td><td>0%</td><td><a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L3-L4">3&ndash;4</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L6-L10">6&ndash;10</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L16">16</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L18-L19">18&ndash;19</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L25">25</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L31">31</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L38">38</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L40-L41">40&ndash;41</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L43-L45">43&ndash;45</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L47">47</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/main.py#L49-L50">49&ndash;50</a></td></tr><tr><td colspan="5"><b>src/pycardgolf/core</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/core/__init__.py">__init__.py</a></td><td>0</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/core/game.py">game.py</a></td><td>31</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/core/hand.py">hand.py</a></td><td>36</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/core/player.py">player.py</a></td><td>9</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/core/round.py">round.py</a></td><td>41</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/core/scoring.py">scoring.py</a></td><td>49</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td colspan="5"><b>src/pycardgolf/interfaces</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/__init__.py">__init__.py</a></td><td>0</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/base.py">base.py</a></td><td>3</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py">cli.py</a></td><td>19</td><td>19</td><td>0%</td><td><a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L3-L5">3&ndash;5</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L8">8</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L11">11</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L13-L15">13&ndash;15</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L17-L19">17&ndash;19</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L23-L24">23&ndash;24</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L27-L28">27&ndash;28</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L30">30</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L32">32</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L34">34</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/interfaces/cli.py#L36">36</a></td></tr><tr><td colspan="5"><b>src/pycardgolf/players</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/__init__.py">__init__.py</a></td><td>0</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py">human.py</a></td><td>69</td><td>69</td><td>0%</td><td><a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L3-L6">3&ndash;6</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L9">9</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L12">12</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L14-L15">14&ndash;15</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L17">17</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L19-L20">19&ndash;20</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L22-L23">22&ndash;23</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L26-L28">26&ndash;28</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L30-L33">30&ndash;33</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L35-L36">35&ndash;36</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L39-L41">39&ndash;41</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L45-L50">45&ndash;50</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L54">54</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L56-L57">56&ndash;57</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L60-L62">60&ndash;62</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L65-L66">65&ndash;66</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L69-L75">69&ndash;75</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L79-L82">79&ndash;82</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L85-L90">85&ndash;90</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L92-L95">92&ndash;95</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L98-L101">98&ndash;101</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L104-L105">104&ndash;105</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/human.py#L107-L109">107&ndash;109</a></td></tr><tr><td colspan="5"><b>src/pycardgolf/players/bots</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/__init__.py">__init__.py</a></td><td>0</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py">random_bot.py</a></td><td>45</td><td>45</td><td>0%</td><td><a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L3">3</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L5-L8">5&ndash;8</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L11">11</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L14">14</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L16-L17">16&ndash;17</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L19-L21">19&ndash;21</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L23">23</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L25">25</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L28">28</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L30-L32">30&ndash;32</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L34">34</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L36">36</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L38-L41">38&ndash;41</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L47-L48">47&ndash;48</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L50">50</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L52">52</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L55-L58">55&ndash;58</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L63-L65">63&ndash;65</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L67-L71">67&ndash;71</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L77-L79">77&ndash;79</a>, <a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/players/bots/random_bot.py#L82-L83">82&ndash;83</a></td></tr><tr><td colspan="5"><b>src/pycardgolf/utils</b></td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/utils/__init__.py">__init__.py</a></td><td>0</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/utils/card.py">card.py</a></td><td>52</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/utils/constants.py">constants.py</a></td><td>3</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/utils/deck.py">deck.py</a></td><td>70</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td>&nbsp; &nbsp;<a href="https://github.com/hwilco/PyCardGolf/blob/main/src/pycardgolf/utils/enums.py">enums.py</a></td><td>30</td><td>0</td><td>100%</td><td>&nbsp;</td></tr><tr><td><b>TOTAL</b></td><td><b>483</b></td><td><b>154</b></td><td><b>68%</b></td><td>&nbsp;</td></tr></tbody></table></details>
<!-- Pytest Coverage Comment:End -->

## Table of Contents
1. [Rules](#rules)
2. [Architecture](#architecture)
3. [Design](#design)
4. [Installation](#installation)
5. [Development](#development)
6. [Testing](#testing)

## Rules
PyCardGolf follows the standard [rules of Card Golf](src/pycardgolf/RULES.md).
The goal is to have the lowest score after a set number of rounds.

You can also view the rules directly in the CLI by running with the `--rules` flag:
```bash
poetry run pycardgolf --rules
```

## Architecture
PyCardGolf is built as an event-driven game engine that strictly decouples game logic from user interfaces.

### Core Components
- **Game Engine (`core/`)**: Manages rounds, player turns, and the state machine. It emits `GameEvent` objects and accepts `Action` objects.
- **Interfaces (`interfaces/`)**: Defines abstract base classes for rendering and input handling. This allows for terminal, GUI, or bot-driven interfaces.
- **Observation Layer**: Provides players with a sanitized view of the game state, ensuring that information (like face-down cards or opponent's private data) is only visible when it should be.

### System Overview
```mermaid
graph TB
    subgraph Core["core/ â€” Game Engine"]
        Game["Game"]
        EventBus["EventBus"]
        Observation["Observation"]

        subgraph StateMachine["Round State Machine"]
            Round["Round (Manager)"]
            Phases["Phases (Current State)"]
        end
    end

    subgraph Interfaces["interfaces/ â€” I/O"]
        GameRenderer["GameRenderer (ABC)"]
        GameInput["GameInput (ABC)"]
    end

    subgraph Players["players/ â€” Player Logic"]
        HumanPlayer["HumanPlayer"]
        RandomBot["RandomBot"]
    end

    %% Internal Engine Flow
    Game -- Starts & Manages --> Round
    Round -- Transitions through --> Phases
    Phases -- Updates State & Generates --> Observation

    %% Event-Driven Rendering
    Game -- Publishes Events --> EventBus
    EventBus -- Triggers --> GameRenderer

    %% Observation Flow (State to Players)
    Observation -- Sent to --> HumanPlayer
    Observation -- Sent to --> RandomBot

    %% Input Flow & Context Rendering
    HumanPlayer -- Prompts via --> GameInput
    GameInput -. Uses for prompt context .-> GameRenderer
    GameInput -- Returns Action --> HumanPlayer

    %% Decisions to Engine (Processed by Current Phase)
    HumanPlayer -- Sends Action to --> Phases
    RandomBot -- Sends Action to --> Phases
```

### Extensibility
The library is designed to be easily extended:
- **New Players**: Inherit from `BasePlayer` and implement `get_action(observation)`.
- **New Interfaces**: Implement `GameRenderer` (for output) and `GameInput` (for human-driven decisions).
- **Custom Bots**: Create a bot that analyzes the `Observation` to return the optimal `Action`.

## Playing the Game

### Prerequisites
- [Poetry](https://python-poetry.org/docs/) (>=2.2.1)
- [Python](https://www.python.org/downloads/) (3.13.x)

### Installation
Install the game without development dependencies:
```bash
poetry install --without dev
```

### Running the Game
Run a quick game with 1 human player, 1 bot, and 1 round:
```bash
poetry run pycardgolf --humans 1 --bots 1 --rounds 1
```

Customization options:
- `--humans N`: Number of human players (default: 1)
- `--bots N`: Number of bot players (default: 1)
- `--rounds N`: Number of rounds to play (default: 9)

Example (2 humans, 3 rounds):
```bash
poetry run pycardgolf --humans 2 --bots 0 --rounds 3
```

## Development Setup

We use a **Container-First** development workflow. This ensures a consistent environment for all developers and AI agents.

### ðŸ³ Recommended: VS Code Dev Containers
The fastest way to develop is using the VS Code **Dev Containers** extension.

1. **Prerequisites**: Install [Docker Desktop](https://www.docker.com/products/docker-desktop/) and the VS Code [Dev Containers extension](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers).
2. **Launch**: Open this repository in VS Code. When prompted with *"Reopen in Container"*, select **Yes**.
3. **Result**: Your terminal, debugger, and linting (Pyrefly/Ruff) will run inside the Linux container using the internal Python 3.13 interpreter.

*Note: There is currently (as of 2/23/2026) an issue with the VS Code Dev Container extension when used with Antigravity. Please manually build and start the container using `docker-compose up -d --build`, then you can access it in Antigravity by using `Reopen in Container`.

### ðŸ› ï¸ Alternative: Manual Docker Setup
If you prefer using a different IDE or a raw terminal:

1. **Build and Start**:
   ```bash
   docker-compose up -d --build
   ```
2. **Access the Environment**:
   ```bash
   docker exec -it pycardgolf-dev-container bash
   ```
3. **Run Commands**:
   Once inside the container, use Poetry normally:
   ```bash
   poetry run pytest
   poetry run pycardgolf --humans 1
   ```

### âš ï¸ Local Development (Not Recommended)
If you must develop natively without Docker:

1. **Prerequisites**: [Poetry](https://python-poetry.org/docs/) (>=2.2.1) and [Python](https://www.python.org/downloads/) (3.13.x).
2. **Install**: `poetry install`
3. **Note**: You may encounter pathing or binary issues if switching between local and containerized environments due to `.venv` conflicts.

## ðŸ›  Contributor Setup: SSH & Git

To push/pull from within the Dev Container, this project uses **SSH Agent Forwarding**. This allows the container to securely "borrow" your host machine's identity without copying private keys into the Docker image.

### 1. Ensure your SSH Agent is running
**Windows (PowerShell):**
```powershell
# Set the service to automatic and start it
Get-Service ssh-agent | Set-Service -StartupType Automatic
Start-Service ssh-agent

# Load your key into the agent
ssh-add ~/.ssh/id_ed25519  # Replace with your specific key path if different
```

### 2. Troubleshooting "Permission Denied (publickey)"
If running `ssh-add -l` inside the Antigravity/VS Code terminal returns "No such file or directory," the bridge between your host and the container is broken.

**Windows 10/11 Fix:**
Windows doesn't always set the `SSH_AUTH_SOCK` environment variable by default. You must set it on your **host machine** so the IDE knows where the "pipe" is located.

1. (Host) Run this in PowerShell as **Administrator**:
   ```powershell
   $env:SSH_AUTH_SOCK = [System.Environment]::GetEnvironmentVariable("SSH_AUTH_SOCK", "User")
   ```
2. (Host) Restart Docker Desktop and rebuild container.
3. (Host) **Restart your IDE completely** (ensure all background processes are killed).
4. (Container) Run `ssh-add -l` to verify your key is loaded.

---
*Note for Mac/Linux Users: This setup typically works out of the box as the `SSH_AUTH_SOCK` variable is natively defined.*

### Pre-commit Hooks
Install the pre-commit hooks to ensure code quality:
```bash
poetry run pre-commit install
```
Run manually:
```bash
poetry run pre-commit run --all-files
```

## Testing

### Running Tests
```bash
poetry run pytest
```

### Coverage Report
```bash
poetry run pytest --cov=pycardgolf --cov-report=term-missing --cov-branch
```

### Focused Testing
- **Unit tests only**: `poetry run pytest tests/unit`
- **Integration tests only**: `poetry run pytest tests/integration`
